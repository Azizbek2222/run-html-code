<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<title>HTML → Real Link (GitHub Pages)</title>
<style>
  body{font-family:sans-serif;background:#0f172a;color:#e5e7eb;padding:20px}
  textarea{width:100%;height:220px;border-radius:8px;padding:10px}
  input,button{padding:10px;border-radius:8px;border:none}
  button{background:#22c55e;color:#052e16;cursor:pointer}
  .box{max-width:900px;margin:auto}
  .out{margin-top:15px;word-break:break-all}
</style>
</head>
<body>
<div class="box">
  <h2>HTML kodni yoz → Real link ol</h2>

  <textarea id="htmlCode"><!DOCTYPE html>
<html>
<body>
<h1>Salom!</h1>
<p>Bu real GitHub Pages link.</p>
</body>
</html></textarea>

  <br><br>

  <!-- SOZLAMALAR -->
  <input id="token" placeholder="GitHub TOKEN" style="width:100%" />
  <br><br>
  <input id="repo" placeholder="Repo nomi" />
  <input id="path" placeholder="index.html" value="index.html" />
  <br><br>

  <button onclick="upload()">Link yaratish</button>

  <div class="out" id="result"></div>
</div>

<script>
async function upload(){
  const token = document.getElementById('token').value.trim();
  const repo  = document.getElementById('repo').value.trim();
  const path  = document.getElementById('path').value.trim();
  const html  = document.getElementById('htmlCode').value;

  if(!token||!repo||!path){ alert("Hamma maydonlarni to‘ldir"); return; }

  // GitHub token orqali foydalanuvchi username olish
  const userRes = await fetch('https://api.github.com/user', {
    headers: { Authorization: `token ${token}` }
  });
  if(!userRes.ok){ alert("Token xato yoki foydalanuvchi topilmadi"); return; }
  const userData = await userRes.json();
  const owner = userData.login;

  const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

  // oldingi fayl bo‘lsa sha olish
  let sha = null;
  const check = await fetch(api, { headers:{Authorization:`token ${token}`}});
  if(check.ok){
    const j = await check.json();
    sha = j.sha;
  }

  const res = await fetch(api,{
    method:"PUT",
    headers:{
      "Authorization":`token ${token}`,
      "Content-Type":"application/json"
    },
    body: JSON.stringify({
      message: "upload via html tool",
      content: btoa(unescape(encodeURIComponent(html))),
      sha: sha
    })
  });

  const data = await res.json();
  if(!res.ok){
    document.getElementById('result').innerText = "Xato: " + (data.message||res.status);
    return;
  }

  const link = `https://${owner}.github.io/${repo}/${path}`;
  document.getElementById('result').innerHTML =
    `Tayyor link: <a href="${link}" target="_blank">${link}</a>
     <br><button onclick="navigator.clipboard.writeText('${link}')">Nusxalash</button>`;
}
</script>
</body>
</html>